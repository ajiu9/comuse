import{_ as $,a as D}from"./chunks/FunctionInfo.vue_vue_type_script_setup_true_lang.DNucBZhK.js";import{_ as F}from"./chunks/DemoContainer.vue_vue_type_script_setup_true_lang.D2V_4-Pw.js";import{d as S,r as _,C as z,i as Y,o as y,j as l,F as q,W as C,t as j,g as X,a3 as A,y as W,w as H}from"./chunks/vue.3cVhufXJ.js";import"./chunks/metadata.C-GyhqMa.js";class N{constructor(t,e){this.element=t,this.recognizer=e,this.isListeningMouse=!1,this.contexts=new Map,this.setupMouseListeners(),this.setupTouchListeners()}setupMouseListeners(){const t=document.documentElement;this.element.addEventListener("mousedown",e=>{const s=e,i=Object.create(null);this.contexts.set(`mouse${1<<s.button}`,i),this.recognizer.start(s,i);const c=d=>{const r=d;let n=1;for(;n<=r.buttons;){if(n&r.buttons){let a;n===2?a=4:n===4?a=2:a=n;const o=this.contexts.get(`mouse${a}`);o&&this.recognizer.move(r,o)}n=n<<1}},u=d=>{const r=d,n=this.contexts.get(`mouse${1<<r.button}`);n&&this.recognizer.end(r,n),this.contexts.delete(`mouse${1<<r.button}`),r.buttons===0&&(t.removeEventListener("mousemove",c),t.removeEventListener("mouseup",u),this.isListeningMouse=!1)};this.isListeningMouse||(t.addEventListener("mousemove",c),t.addEventListener("mouseup",u),this.isListeningMouse=!0)})}setupTouchListeners(){this.element.addEventListener("touchstart",t=>{const e=t;for(const s of e.changedTouches){const i=Object.create(null);this.contexts.set(s.identifier,i),this.recognizer.start(s,i)}}),this.element.addEventListener("touchmove",t=>{const e=t;for(const s of e.changedTouches){const i=this.contexts.get(s.identifier);i&&(t.preventDefault(),this.recognizer.move(s,i))}}),this.element.addEventListener("touchend",t=>{const e=t;for(const s of e.changedTouches){const i=this.contexts.get(s.identifier);i&&(this.recognizer.end(s,i),this.contexts.delete(s.identifier))}}),this.element.addEventListener("touchcancel",t=>{const e=t;for(const s of e.changedTouches){const i=this.contexts.get(s.identifier);i&&(this.recognizer.cancel(s,i),this.contexts.delete(s.identifier))}})}}class G{constructor(t){this.dispatcher=t}start(t,e){e.startX=t.clientX,e.startY=t.clientY,this.dispatcher.dispatch("start",{clientX:t.clientX,clientY:t.clientY}),e.points=[{t:Date.now(),x:t.clientX,y:t.clientY}],e.isTap=!0,e.isPan=!1,e.isPress=!1,e.handler=setTimeout(()=>{e.isTap=!1,e.isPan=!1,e.isPress=!0,e.handler=null,this.dispatcher.dispatch("press",{})},500)}move(t,e){const s=t.clientX-e.startX,i=t.clientY-e.startY;!e.isPan&&s**2+i**2>100&&(e.isPan=!0,e.isTap=!1,e.isPress=!1,e.isVertical=Math.abs(s)-Math.abs(i)>=0,clearTimeout(e.handler??void 0),this.dispatcher.dispatch("panStart",{startX:e.startX,startY:e.startY,clientX:t.clientX,clientY:t.clientY,isVertical:e.isVertical})),e.isPan&&this.dispatcher.dispatch("pan",{startX:e.startX,startY:e.startY,clientX:t.clientX,clientY:t.clientY,isVertical:e.isVertical}),e.points=e.points.filter(c=>Date.now()-c.t<500),e.points.push({t:Date.now(),x:t.clientX,y:t.clientY})}end(t,e){e.isTap&&(this.dispatcher.dispatch("tap",{startX:e.startX,startY:e.startY,clientX:t.clientX,clientY:t.clientY}),clearTimeout(e.handler??void 0)),e.isPress&&this.dispatcher.dispatch("pressEnd",{}),e.points=e.points.filter(i=>Date.now()-i.t<500);let s=0;e.points.length&&(s=Math.sqrt((t.clientX-e.points[0].x)**2+(t.clientY-e.points[0].y)**2)/(Date.now()-e.points[0].t)),s>1.5?(e.isFlick=!0,this.dispatcher.dispatch("flick",{startX:e.startX,startY:e.startY,clientX:t.clientX,clientY:t.clientY,isVertical:e.isVertical,isFlick:e.isFlick,velocity:s})):e.isFlick=!1,e.isPan&&this.dispatcher.dispatch("panEnd",{startX:e.startX,startY:e.startY,clientX:t.clientX,clientY:t.clientY,isVertical:e.isVertical,isFlick:e.isFlick,velocity:s}),this.dispatcher.dispatch("end",{startX:e.startX,startY:e.startY,clientX:t.clientX,clientY:t.clientY,isVertical:e.isVertical,isFlick:e.isFlick,isPan:e.isPan,velocity:s})}cancel(t,e){clearTimeout(e.handler),this.dispatcher.dispatch("cancel",{})}}class I{constructor(t){this.element=t}dispatch(t,e){const s=new Event(t);for(const i in e)s[i]=e[i];this.element.dispatchEvent(s)}}function O(m){new N(m,new G(new I(m)))}const B={class:"flex flex-col items-center gap-4 p-4"},R={class:"w-full space-y-2"},J={class:"bg-gray-50 p-4 rounded-lg"},Q=S({__name:"demo",setup(m){const t=_(null),e=_([]),s=_(null),i=_({x:0,y:0}),c=_({x:0,y:0}),u=r=>{e.value.unshift(`${new Date().toLocaleTimeString()}: ${r}`),e.value.length>5&&e.value.pop()},d=(r,n,a)=>Math.min(Math.max(r,n),a);return z(()=>{if(!t.value||!s.value)return;O(t.value);const r=s.value.offsetWidth,n=s.value.offsetHeight;t.value.addEventListener("tap",a=>{u(`Tap at (${a.clientX}, ${a.clientY})`)}),t.value.addEventListener("press",()=>{u("Press detected")}),t.value.addEventListener("pressEnd",()=>{u("Press ended")}),t.value.addEventListener("panStart",a=>{c.value={x:i.value.x,y:i.value.y};const o=Math.abs(a.clientX-a.startX),b=Math.abs(a.clientY-a.startY)>o;u(`Pan started, direction: ${b?"vertical":"horizontal"}`)}),t.value.addEventListener("pan",a=>{if(s.value&&t.value){const o=a.clientX-a.startX,g=a.clientY-a.startY,b=t.value.offsetWidth,k=t.value.offsetHeight,v=b-r,p=k-n,h=d(c.value.x+o,0,v),f=d(c.value.y+g,0,p);i.value={x:h,y:f},s.value.style.transform=`translate(${h}px, ${f}px)`}}),t.value.addEventListener("panEnd",a=>{if(u(`Pan ended, ${a.isFlick?"with":"without"} flick`),a.isFlick){const o=a.velocity,g=Math.atan2(a.clientY-a.startY,a.clientX-a.startX),b=o*Math.cos(g),k=o*Math.sin(g);let v=i.value.x,p=i.value.y,h=b,f=k;const L=.95;if(typeof window>"u")return;const P=()=>{if(!s.value||!t.value)return;const M=t.value.offsetWidth,V=t.value.offsetHeight,T=M-r,x=V-n;h*=L,f*=L;const w=v+h*16,E=p+f*16;(w<=0||w>=T)&&(h=0),(E<=0||E>=x)&&(f=0),v=d(w,0,T),p=d(E,0,x),i.value={x:v,y:p},s.value.style.transform=`translate(${v}px, ${p}px)`,(Math.abs(h)>.1||Math.abs(f)>.1)&&!(h===0&&f===0)&&window.requestAnimationFrame(P)};window.requestAnimationFrame(P)}}),t.value.addEventListener("flick",a=>{u(`Flick detected with velocity: ${a.velocity.toFixed(2)}`)})}),(r,n)=>(y(),Y("div",B,[l("div",{ref_key:"gestureArea",ref:t,class:"relative w-full h-300px bg-gray-100 rounded-lg overflow-hidden touch-none"},[l("div",{ref_key:"box",ref:s,class:"absolute w-100px h-100px bg-blue-500 rounded-lg cursor-move"},null,512)],512),l("div",R,[n[0]||(n[0]=l("p",{class:"font-bold"}," Gesture Log: ",-1)),l("div",J,[(y(!0),Y(q,null,C(e.value,(a,o)=>(y(),Y("div",{key:o,class:"text-sm text-gray-600"},j(a),1))),128))])]),n[1]||(n[1]=l("div",{class:"w-full space-y-2"},[l("p",{class:"font-bold"}," Instructions: "),l("ul",{class:"list-disc list-inside text-sm text-gray-600 space-y-1"},[l("li",null,"Tap anywhere in the gesture area"),l("li",null,"Press and hold for press gesture"),l("li",null,"Drag the blue box to move it (constrained within the area)"),l("li",null,"Quickly release after panning for flick with inertia")])],-1))]))}}),se=JSON.parse('{"title":"Gesture","description":"","frontmatter":{"category":"Animation"},"headers":[],"relativePath":"shared/gesture/index.md","filePath":"shared/gesture/index.md","lastUpdated":1736236085000}'),U={name:"shared/gesture/index.md"},ie=Object.assign(U,{setup(m){return(t,e)=>{const s=$,i=F,c=D;return y(),Y("div",null,[e[1]||(e[1]=l("h2",{id:"demo",tabindex:"-1"},[W("Demo "),l("a",{class:"header-anchor",href:"#demo","aria-label":'Permalink to "Demo"'},"​")],-1)),X(s,{fn:"gesture"}),X(i,null,{default:H(()=>[e[0]||(e[0]=l("p",{class:"demo-source-link"},[l("a",{href:"https://github.com/ajiu9/comuse/blob/main/packages/shared/gesture/demo.vue",target:"_blank"},"source")],-1)),X(Q)]),_:1}),e[2]||(e[2]=A('<h1 id="gesture" tabindex="-1">Gesture <a class="header-anchor" href="#gesture" aria-label="Permalink to &quot;Gesture&quot;">​</a></h1><h2 id="source" tabindex="-1">Source <a class="header-anchor" href="#source" aria-label="Permalink to &quot;Source&quot;">​</a></h2><p><a href="https://github.com/ajiu9/comuse/blob/main/packages/shared/gesture/index.ts" target="_blank" rel="noreferrer">Source</a> • <a href="https://github.com/ajiu9/comuse/blob/main/packages/shared/gesture/demo.vue" target="_blank" rel="noreferrer">Demo</a> • <a href="https://github.com/ajiu9/comuse/blob/main/packages/shared/gesture/index.md" target="_blank" rel="noreferrer">Docs</a></p><h2 id="changelog" tabindex="-1">Changelog <a class="header-anchor" href="#changelog" aria-label="Permalink to &quot;Changelog&quot;">​</a></h2>',4)),X(c,{fn:"gesture"})])}}});export{se as __pageData,ie as default};
